#!/usr/bin/env ruby

require "bundler/setup"
require "optparse"
require "logger"

require "diskAudit"

LOGFILE = "/var/log/diskAudit/diskAudit.log"

options = {}

def setupOptions()
  parser = OptionParser.new do |o|
    o.on('-v','generate verbose output') { |k| options[:verbose] = true }
  end
  return parser
end

$log = Logger.new(File.open(LOGFILE,mode="a"))
$log.level = Logger::DEBUG

setupOptions.parse!
cmd = ARGV[0]

auditor = DiskAudit::DiskAudit.new
case cmd
  when "dump"
    auditor.dump_dir(ARGV[1])
  when "remote"
    auditor.execute_remote(ARGV[1..-1])
  when "report"
    auditor.report(ARGV[1..-1])
  else
    $log.error("Unknown command '#{cmd}'")
end


#dir = Gem.datadir("diskAudit")
#path = File.join(dir,"thing.html.erb")
#File.open(path) do |fd|
#  data = fd.read()
#  STDOUT.write(data)
#end
